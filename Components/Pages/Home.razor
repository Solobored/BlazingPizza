@page "/"
@using BlazingPizza.Models
@inject PizzaStoreContext Db
@inject OrderState OrderState

<h1 class="page-title">Welcome to Blazing Pizza</h1>
<p class="lead">Choose from our specials and order a pizza. Hot & fresh — ready in minutes.</p>

<div class="pizza-grid">
    @foreach (var s in specials)
    {
        <div class="pizza-card card">
            <img src="@GetImageFor(s)" class="pizza-img" alt="@s.Name" />
            <div class="card-body">
                <h3 class="pizza-name">@s.Name</h3>
                <p class="pizza-desc">@s.Description</p>
                <div class="card-footer">
                    <div class="price">£@s.Price.ToString("0.00")</div>
                    <button class="btn btn-primary" @onclick="() => AddToOrder(s)">Add</button>
                </div>
            </div>
        </div>
    }
</div>

@code {
    List<PizzaSpecial> specials = new();

    protected override void OnInitialized()
    {
        specials = Db.Specials.ToList();
    }

    void AddToOrder(PizzaSpecial special)
    {
        var pizza = new Pizza { SpecialId = special.Id, Special = special, Size = "Medium" };
        OrderState.Order.Pizzas.Add(pizza);
    }

    string GetImageFor(PizzaSpecial s)
    {
        // Use local images if present in wwwroot/images; fallback to a placeholder data URI
        var safeName = (s.Name ?? "pizza").ToLower().Replace(" ", "-");
        var url = $"images/{safeName}.jpg";
        return System.IO.File.Exists(Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", url))
            ? url
            : "https://via.placeholder.com/380x220.png?text=Pizza";
    }
}
